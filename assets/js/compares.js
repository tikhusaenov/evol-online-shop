/*!
 * CompareProducts v0.6.0
 * Vladimir Ivanin
 * 2018
 */
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
function add(e,o){var t={item:e};o&&(t.button=o),Compare.add(t)}function remove(e,o){var t={item:e};o&&(t.button=o),Compare.remove(t)}function update(){Compare.update()}function getCompare(){return Compare.getCompare()}function getCompareIds(){for(var e=[],o=Compare.getCompare(),t=0;t<o.products.length;t++)e.push(o.products[t].id);return e}module.exports={add:add,remove:remove,update:update,getCompareIds:getCompareIds,getCompare:getCompare};
},{}],2:[function(require,module,exports){
var render=require("./render");function binding(){bindAdd(this),bindRemove(this),bindTrigger(this)}function bindRemove(t){var e=getDataAttrName(t.options.selectors.remove);$(document).on("click",e,function(e){e.preventDefault(),t.productIds=t.api.getCompareIds();var d=$(this).data(t.options.selectors.remove),s=getStatusProduct($(this),t.productIds,d,t.options.classes.added,t.options.classes.notAdded);if(s.isActive||!s.notAdded){var o=render.getAllSelectors(t.options,[d]);t.api.remove(d,o.added)}})}function bindAdd(t){var e=getDataAttrName(t.options.selectors.add);$(document).on("click",e,function(e){e.preventDefault(),t.productIds=t.api.getCompareIds();var d=t.api.getCompare(),s=$(this).data(t.options.selectors.add),o=getStatusProduct($(this),t.productIds,s,t.options.classes.added,t.options.classes.notAdded);if(!(o.isActive&&o.isAdded||t.productIds.length>d.maxItems)){var r=render.getAllSelectors(t.options,[s]);t.api.add(s,r.added)}})}function bindTrigger(t){var e=getDataAttrName(t.options.selectors.trigger);$(document).on("click",e,function(e){e.preventDefault();var d=t.api.getCompare();t.productIds=t.api.getCompareIds();var s=$(this).data(t.options.selectors.trigger);if(getStatusProduct($(this),t.productIds,s,t.options.classes.added,t.options.classes.notAdded).isActive){var o=render.getAllSelectors(t.options,[s]);t.api.remove(s,o.added)}else{if(t.productIds.length>d.maxItems)return;o=render.getAllSelectors(t.options,[s]);t.api.add(s,o.added)}})}function getStatusProduct(t,e,d,s,o){return{isActive:e.indexOf(d)>-1,isAdded:t.hasClass(s),notAdded:t.hasClass(o)}}function getDataAttrName(t,e){return"[data-"+(e?t+'="'+e+'"':t)+"]"}module.exports=binding;
},{"./render":6}],3:[function(require,module,exports){
var defaults=require("../variables").defaults,system=require("../variables").system,init=require("./init"),api=require("./api"),binding=require("./binding"),methods=require("./methods"),CompareProducts=function(i){return this.state={productIds:[],data:{}},this.options=$.extend(!0,{},defaults,i),this.api=api,this.init=init,this.binding=binding,this.update=methods.update,EventBus?(this.init(),this.binding()):console.warn("Не подключен common.js"),this};module.exports=CompareProducts;
},{"../variables":8,"./api":1,"./binding":2,"./init":4,"./methods":5}],4:[function(require,module,exports){
var render=require("./render");function init(){var e=this,t=e.options;EventBus.subscribe("update_items:insales:compares",function(t){e.state.data=t,e.update()}),EventBus.subscribe("init:insales:compares",function(n){e.state.data=n,render.update(n,t,e.api.getCompareIds()),t.onInit(n)}),EventBus.subscribe("overload:insales:compares",function(n){e.state.data=n,render.overload(n,t),t.onOverload(n)}),EventBus.subscribe("add_item:insales:compares",function(n){e.state.data=n;var a=n.action?n.action.button:null;a&&render.add(a,t),t.onAdd(n)}),EventBus.subscribe("remove_item:insales:compares",function(n){e.state.data=n;var a=n.action?n.action.button:null;a&&render.remove(a,t),t.onRemove(n)})}module.exports=init;
},{"./render":6}],5:[function(require,module,exports){
var render=require("./render");function update(){var e=this.state.data||{action:{method:"init"}},t=this.options,a=this.api.getCompareIds();render.update(e,t,a),t.onUpdate(e)}module.exports={update:update};
},{"./render":6}],6:[function(require,module,exports){
function add(e,t){e.addClass(t.classes.added).removeClass(t.classes.notAdded).removeClass(t.classes.disabled).removeAttr("disabled"),e.attr("title",t.titles.added),t.buttonAddedText&&e.text(t.buttonAddedText)}function remove(e,t){var a=$(getDataAttrName(t.selectors.add));e.addClass(t.classes.notAdded).removeClass(t.classes.added).removeClass(t.classes.disabled).removeAttr("disabled"),a.removeClass(t.classes.disabled).removeAttr("disabled"),e.attr("title",t.titles.notAdded),t.buttonNotAddedText&&e.text(t.buttonNotAddedText)}function update(e,t,a){var s=$(getDataAttrName(t.selectors.counter)),d=e.products.length,r=e.action&&void 0!==e.action.method?e.action.method:"init";if(d&&d>0?s.html(t.counterTemplate.replace("%c%",d)).removeClass(t.classes.empty):t.counterTemplateEmpty?s.html(t.counterTemplateEmpty.replace("%c%",d)).addClass(t.classes.empty):s.html(t.counterTemplate.replace("%c%",d)).addClass(t.classes.empty),"init"==r){var l=getAllSelectors(t,a),o=l.removed,c=l.added;d&&d>0&&add(c,t),remove(o,t)}}function getAllSelectors(e,t){var a=[],s=[];s.push(getDataAttrName(e.selectors.add)),s.push(getDataAttrName(e.selectors.remove)),s.push(getDataAttrName(e.selectors.trigger));for(var d=0;d<t.length;d++)a.push(getDataAttrName(e.selectors.add,t[d])),a.push(getDataAttrName(e.selectors.remove,t[d])),a.push(getDataAttrName(e.selectors.trigger,t[d]));var r=a.join(",");return{added:$(r),removed:$(s.join(",")).not(r)}}function overload(e,t){$(getDataAttrName(t.selectors.add)).addClass(t.classes.disabled).removeAttr("disabled")}function getDataAttrName(e,t){return"[data-"+(t?e+'="'+t+'"':e)+"]"}module.exports={add:add,remove:remove,update:update,getAllSelectors:getAllSelectors,overload:overload};
},{}],7:[function(require,module,exports){
window.CompareProducts=require("CompareProducts");
},{"CompareProducts":3}],8:[function(require,module,exports){
var defaults={selectors:{add:"compares-add",remove:"compares-remove",trigger:"compares-trigger",counter:"compares-counter"},counterTemplate:"(%c%)",counterTemplateEmpty:null,buttonNotAddedText:null,buttonAddedText:null,titles:{added:"Добавлен в сравнение",notAdded:"Добавить в сравнение"},classes:{added:"is-added",notAdded:"not-added",empty:"is-empty",disabled:"is-disabled"},onAdd:function(){},onRemove:function(){},onUpdate:function(){},onInit:function(){},onOverload:function(){}},system={};module.exports={defaults:defaults,system:system};
},{}]},{},[7]);
